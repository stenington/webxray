<html>
<head>
<script src="prototype-1.6.1.js"></script>
<script src="../static-files/jquery.min.js"></script>
<script type="text/javascript">
  jQuery.noConflict();
  var objString = "{foo: ['a', 'b']}";
  eval("var obj = " + objString);
  var gotPreGoggles = JSON.stringify(obj);
</script>
<script src="../static-files/webxray.js"></script>
<script type="text/javascript">
  var gotPostGoggles = JSON.stringify(obj);

  jQuery(document).ready(function(){

    var expected = jQuery("#expected").html();

    function equals(got, expected, output) {
      output.append(got);
      if( got == expected ) {
        output.css("background-color", "#C6E746");
      } 
      else {
        output.css("background-color", "#FFCACA");
        console.log("Expected: " + expected + ", got: " + got);
      }
    }

    jQuery("#obj").append(objString);
    equals(gotPreGoggles, expected, jQuery("#preGoggles"));
    equals(gotPostGoggles, expected, jQuery("#postGoggles"));
  });
</script>
<style type="text/css">
  #obj,
  #expected {
    background-color: #DDD;
  }
</style>
</head>
<body>
  <pre>
This page includes *prototype.js 1.6.1* and the goggles.

Prototype.js 1.6.1 defines an Array.prototype.toJSON that doubly-quotes array elements within
objects during JSON stringification. This messes up the goggles, but "fixing" it might mess
up the page using prototype.js.

The goggles override the JSON object internally. This page demonstrates that that doesn't leak!

This object: <span id="obj"></span>
Stringifies (with the bug) as: <span id="expected">{"foo":"[\"a\", \"b\"]"}</span>
...which you should see below here twice, stringified both *before* and *after* loading the goggles.

Before: <span id="preGoggles"></span>
 After: <span id="postGoggles"></span>

If the before and after are green, the goggles have not changed external JSON.stringify behavior&mdash;there's no leak! 

</pre>

</body>
</html>
